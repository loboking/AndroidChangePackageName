<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Project Rebuilder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            color: #667eea;
            font-size: 32px;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .required {
            color: #e74c3c;
        }

        .optional {
            color: #999;
            font-weight: normal;
            font-size: 12px;
        }

        input[type="text"],
        input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input[type="file"] {
            padding: 8px;
            cursor: pointer;
        }

        .file-info {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        .btn-primary {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .progress-container {
            display: none;
            margin-top: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .log-container {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
        }

        .log-line {
            padding: 2px 0;
            color: #333;
        }

        .log-line.step {
            color: #667eea;
            font-weight: bold;
            margin-top: 10px;
        }

        .log-line.success {
            color: #27ae60;
        }

        .log-line.error {
            color: #e74c3c;
        }

        .log-line.warning {
            color: #f39c12;
        }

        .success-message {
            display: none;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            font-weight: 600;
        }

        .error-message {
            display: none;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .divider {
            border: none;
            border-top: 1px solid #e0e0e0;
            margin: 30px 0;
        }

        .section-title {
            font-size: 18px;
            color: #667eea;
            margin-bottom: 15px;
            font-weight: 600;
        }

        /* Help Button */
        .help-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            z-index: 1000;
        }

        .help-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        /* Help Modal */
        .help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .help-modal.active {
            display: flex;
        }

        .help-content {
            background: white;
            border-radius: 16px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
        }

        .help-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .help-title {
            font-size: 24px;
            color: #667eea;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            line-height: 1;
        }

        .close-btn:hover {
            color: #333;
        }

        /* Accordion */
        .accordion-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .accordion-header {
            background: #f8f9fa;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #333;
            transition: background 0.3s;
        }

        .accordion-header:hover {
            background: #e9ecef;
        }

        .accordion-header.active {
            background: #667eea;
            color: white;
        }

        .accordion-icon {
            font-size: 18px;
            transition: transform 0.3s;
        }

        .accordion-header.active .accordion-icon {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: white;
        }

        .accordion-content.active {
            max-height: 2500px;
            overflow-y: auto;
        }

        .accordion-body {
            padding: 20px;
            line-height: 1.8;
            color: #555;
        }

        .accordion-body h4 {
            color: #667eea;
            margin: 15px 0 10px 0;
            font-size: 16px;
        }

        .accordion-body ol, .accordion-body ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .accordion-body li {
            margin-bottom: 8px;
        }

        .accordion-body code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #e74c3c;
        }

        .accordion-body img {
            max-width: 100%;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #e0e0e0;
        }

        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 14px;
        }

        /* Checkbox styles */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            font-size: 14px;
            color: #333;
        }

        .checkbox-group:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }
    </style>
</head>
<body>
    <!-- Help Button -->
    <button class="help-btn" onclick="toggleHelp()">?</button>

    <!-- Help Modal -->
    <div class="help-modal" id="helpModal">
        <div class="help-content">
            <div class="help-header">
                <h2 class="help-title">📖 사용 가이드</h2>
                <button class="close-btn" onclick="toggleHelp()">&times;</button>
            </div>

            <!-- Accordion Items -->
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>1. Firebase google-services.json 다운로드 방법</span>
                    <span class="accordion-icon">▼</span>
                </div>
                <div class="accordion-content">
                    <div class="accordion-body">
                        <h4>📥 Firebase 콘솔에서 다운로드</h4>
                        <ol>
                            <li><a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a>에 접속</li>
                            <li>프로젝트 선택 (또는 새 프로젝트 생성)</li>
                            <li>좌측 메뉴에서 <strong>프로젝트 설정</strong> (⚙️ 아이콘) 클릭</li>
                            <li><strong>일반</strong> 탭에서 아래로 스크롤</li>
                            <li><strong>"내 앱"</strong> 섹션에서 Android 앱 선택</li>
                            <li><code>google-services.json</code> 다운로드 버튼 클릭</li>
                        </ol>
                        <div class="note">
                            <strong>💡 주의사항:</strong> google-services.json은 새 패키지명에 맞는 Firebase 프로젝트에서 다운로드해야 합니다.
                        </div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>2. Firebase Admin SDK 비공개 키 생성 (Java)</span>
                    <span class="accordion-icon">▼</span>
                </div>
                <div class="accordion-content">
                    <div class="accordion-body">
                        <h4>🔑 Admin SDK 구성 스니펫 생성</h4>
                        <ol>
                            <li><a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a> 접속</li>
                            <li>프로젝트 선택</li>
                            <li>좌측 메뉴에서 <strong>프로젝트 설정</strong> (⚙️) → <strong>서비스 계정</strong> 탭 클릭</li>
                            <li><strong>"Firebase Admin SDK"</strong> 섹션 확인</li>
                            <li>언어 선택: <strong>Java</strong> 선택</li>
                            <li><strong>"새 비공개 키 생성"</strong> 버튼 클릭</li>
                            <li>확인 팝업에서 <strong>"키 생성"</strong> 클릭</li>
                            <li>JSON 파일 자동 다운로드 (이름: <code>프로젝트명-xxxxx.json</code>)</li>
                        </ol>
                        <div class="note">
                            <strong>⚠️ 보안 주의:</strong> 다운로드한 JSON 파일은 민감한 정보를 포함하므로 절대 공개 저장소에 업로드하지 마세요!
                        </div>
                        <h4>📁 파일 사용 위치</h4>
                        <ul>
                            <li>서버 측 코드에서 Firebase Admin SDK 초기화 시 사용</li>
                            <li>예: 푸시 알림 전송, 사용자 관리, 데이터베이스 접근 등</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>3. 앱 아이콘 준비 방법</span>
                    <span class="accordion-icon">▼</span>
                </div>
                <div class="accordion-content">
                    <div class="accordion-body">
                        <h4>🎨 권장 아이콘 사양</h4>
                        <ul>
                            <li><strong>크기:</strong> 512x512 픽셀 (정사각형)</li>
                            <li><strong>형식:</strong> PNG (투명 배경 지원)</li>
                            <li><strong>배경:</strong> 투명 또는 단색</li>
                        </ul>
                        <h4>✨ 자동 리사이징</h4>
                        <p>업로드한 1개의 이미지가 자동으로 다음 해상도로 변환됩니다:</p>
                        <ul>
                            <li>mdpi: 48x48px</li>
                            <li>hdpi: 72x72px</li>
                            <li>xhdpi: 96x96px</li>
                            <li>xxhdpi: 144x144px</li>
                            <li>xxxhdpi: 192x192px</li>
                        </ul>
                        <div class="note">
                            <strong>💡 팁:</strong> 무료 아이콘 제작 도구 - <a href="https://www.canva.com/" target="_blank">Canva</a>, <a href="https://www.figma.com/" target="_blank">Figma</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>4. 패키지명 작성 규칙</span>
                    <span class="accordion-icon">▼</span>
                </div>
                <div class="accordion-content">
                    <div class="accordion-body">
                        <h4>📝 패키지명 형식</h4>
                        <ul>
                            <li><strong>형식:</strong> <code>com.회사명.앱이름</code></li>
                            <li><strong>규칙:</strong>
                                <ul>
                                    <li>영문 소문자만 사용</li>
                                    <li>점(.)으로 최소 2개 이상 구분</li>
                                    <li>숫자, 언더스코어(_) 허용</li>
                                    <li>특수문자, 공백, 한글 불가</li>
                                </ul>
                            </li>
                        </ul>
                        <h4>✅ 올바른 예시</h4>
                        <ul>
                            <li><code>com.mycompany.myapp</code></li>
                            <li><code>kr.co.example.app2024</code></li>
                            <li><code>com.example.my_app</code></li>
                        </ul>
                        <h4>❌ 잘못된 예시</h4>
                        <ul>
                            <li><code>myapp</code> (점이 없음)</li>
                            <li><code>com.MyApp</code> (대문자 사용)</li>
                            <li><code>com.회사.앱</code> (한글 사용)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>5. BASE_URL 변경 용도</span>
                    <span class="accordion-icon">▼</span>
                </div>
                <div class="accordion-content">
                    <div class="accordion-body">
                        <h4>🌐 BASE_URL이란?</h4>
                        <p>앱에서 서버 API를 호출할 때 사용하는 기본 주소입니다.</p>

                        <div class="note">
                            <strong>⚠️ 중요:</strong> BASE_URL은 반드시 마지막에 슬래시(<code>/</code>)를 붙여야 합니다!
                        </div>

                        <h4>📋 사용 예시</h4>
                        <ul>
                            <li><strong>개발 서버:</strong> <code>https://dev-api.example.com/</code> ✅</li>
                            <li><strong>운영 서버:</strong> <code>https://api.example.com/</code> ✅</li>
                            <li><strong>로컬 테스트:</strong> <code>http://localhost:8080/</code> ✅</li>
                        </ul>

                        <h4>❌ 잘못된 예시</h4>
                        <ul>
                            <li><code>https://api.example.com</code> (슬래시 없음) ❌</li>
                            <li><code>https://api.example.com/api</code> (경로 포함) ❌</li>
                        </ul>

                        <h4>🔧 자동 변경 대상</h4>
                        <p>다음 파일의 BASE_URL 상수가 자동으로 변경됩니다:</p>
                        <ul>
                            <li><code>Config.kt</code></li>
                            <li><code>ApiService.kt</code></li>
                        </ul>
                        <div class="note">
                            <strong>💡 참고:</strong> BASE_URL을 입력하지 않으면 기존 값을 유지합니다.
                        </div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>6. 리빌드 완료 후 확인사항</span>
                    <span class="accordion-icon">▼</span>
                </div>
                <div class="accordion-content">
                    <div class="accordion-body">
                        <h4>✅ 다운로드 파일 확인</h4>
                        <ul>
                            <li>파일명: <code>(패키지명변경)앱이름.zip</code></li>
                            <li>압축 해제 후 Android Studio에서 열기</li>
                        </ul>
                        <h4>📋 변경 확인사항</h4>
                        <ol>
                            <li><strong>패키지명:</strong> <code>build.gradle.kts</code>의 applicationId 확인</li>
                            <li><strong>앱 이름:</strong> <code>res/values/strings.xml</code>의 app_name 확인</li>
                            <li><strong>버전:</strong> versionCode=1, versionName="1.0.0" 확인</li>
                            <li><strong>Firebase:</strong> <code>app/google-services.json</code> 존재 확인</li>
                            <li><strong>아이콘:</strong> <code>res/mipmap-*/ic_launcher.png</code> 확인</li>
                        </ol>
                        <h4>🔍 로그 파일 확인</h4>
                        <p>ZIP 파일 내부의 <code>ANDROID_REBUILDER_LOG.txt</code>에서 상세한 변경 내역을 확인할 수 있습니다.</p>
                        <h4>🚀 다음 단계</h4>
                        <ol>
                            <li>Android Studio에서 Gradle Sync 실행</li>
                            <li>빌드 → 테스트 → 배포</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>7. AppFactory 관리자 사이트 연동 가이드</span>
                    <span class="accordion-icon">▼</span>
                </div>
                <div class="accordion-content">
                    <div class="accordion-body">
                        <h4>🎯 목표</h4>
                        <ul>
                            <li>AppFactory Admin Site에서 앱 등록</li>
                            <li>Firebase와 AppFactory 연동</li>
                            <li>Push 알림 서버 연결</li>
                        </ul>

                        <h4>🔗 Step 1: Firebase 앱 등록</h4>
                        <ol>
                            <li><a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a> 접속</li>
                            <li><strong>신규 프로젝트 생성</strong> 또는 기존 프로젝트 선택</li>
                            <li>생성된 프로젝트 진입</li>
                            <li><strong>Android 앱 추가</strong> 버튼 클릭</li>
                            <li>패키지명 입력 후 앱 등록</li>
                            <li><code>google-services.json</code> 다운로드</li>
                        </ol>
                        <div class="note">
                            <strong>💡 주의:</strong> 다운로드한 <code>google-services.json</code>은 이 리빌더 툴에서 업로드할 때 사용됩니다.
                        </div>

                        <h4>🔑 Step 2: Firebase Admin SDK 비공개 키 생성</h4>
                        <ol>
                            <li>Firebase Console에서 현재 프로젝트 화면</li>
                            <li>좌측 메뉴 상단의 <strong>프로젝트 설정</strong> (⚙️ 아이콘) 클릭</li>
                            <li><strong>서비스 계정</strong> 탭 클릭</li>
                            <li><strong>"Firebase Admin SDK"</strong> 섹션 확인</li>
                            <li>언어 선택: <strong>Java</strong> 선택</li>
                            <li><strong>"새 비공개 키 생성"</strong> 버튼 클릭</li>
                            <li>확인 팝업에서 <strong>"키 생성"</strong> 버튼 클릭</li>
                            <li>JSON 파일 자동 다운로드 (파일명: <code>프로젝트명-xxxxx.json</code>)</li>
                        </ol>
                        <div class="note">
                            <strong>⚠️ 보안 주의:</strong> 다운로드한 JSON 파일은 민감한 정보를 포함하므로 절대 공개 저장소에 업로드하지 마세요!
                        </div>

                        <h4>🌐 Step 3: AppFactory Admin Site에서 앱 등록</h4>
                        <ol>
                            <li><a href="https://adm.app-factory.kr/" target="_blank">AppFactory Admin Site</a> 접속</li>
                            <li>로그인 (계정이 없으면 회원가입)</li>
                            <li><strong>앱 관리</strong> 메뉴로 이동</li>
                            <li><strong>앱 등록</strong> 버튼 클릭</li>
                            <li>앱 정보 입력:
                                <ul>
                                    <li>앱 이름</li>
                                    <li>패키지명 (Firebase에 등록한 것과 동일하게)</li>
                                    <li>기타 필요한 정보</li>
                                </ul>
                            </li>
                        </ol>

                        <h4>📤 Step 4: Firebase 비공개 키 업로드</h4>
                        <ol>
                            <li>AppFactory Admin Site에서 등록한 앱 선택</li>
                            <li><strong>Firebase 설정</strong> 또는 <strong>Push 설정</strong> 메뉴 이동</li>
                            <li><strong>파일 업로드</strong> 버튼 클릭</li>
                            <li>Step 2에서 다운로드한 <strong>비공개 키 JSON 파일</strong> 선택</li>
                            <li><strong>저장</strong> 버튼 클릭</li>
                            <li>연동 상태 확인: <strong>"연동 완료"</strong> 표시되면 성공</li>
                        </ol>

                        <h4>✅ 연동 확인 방법</h4>
                        <ol>
                            <li>AppFactory Admin Site에서 <strong>Push 전송</strong> 메뉴 이동</li>
                            <li>테스트 메시지 작성</li>
                            <li><strong>테스트 전송</strong> 버튼 클릭</li>
                            <li>앱에서 Push 알림 수신 확인</li>
                        </ol>

                        <h4>📝 요약</h4>
                        <table style="width:100%; border-collapse: collapse; margin: 15px 0;">
                            <tr style="background: #f8f9fa;">
                                <th style="border: 1px solid #e0e0e0; padding: 10px;">단계</th>
                                <th style="border: 1px solid #e0e0e0; padding: 10px;">사이트</th>
                                <th style="border: 1px solid #e0e0e0; padding: 10px;">작업</th>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #e0e0e0; padding: 10px;">1</td>
                                <td style="border: 1px solid #e0e0e0; padding: 10px;">Firebase Console</td>
                                <td style="border: 1px solid #e0e0e0; padding: 10px;">프로젝트 생성 + google-services.json 다운로드</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #e0e0e0; padding: 10px;">2</td>
                                <td style="border: 1px solid #e0e0e0; padding: 10px;">Firebase Console</td>
                                <td style="border: 1px solid #e0e0e0; padding: 10px;">Admin SDK 비공개 키 생성 (Java)</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #e0e0e0; padding: 10px;">3</td>
                                <td style="border: 1px solid #e0e0e0; padding: 10px;">AppFactory Admin</td>
                                <td style="border: 1px solid #e0e0e0; padding: 10px;">앱 등록</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #e0e0e0; padding: 10px;">4</td>
                                <td style="border: 1px solid #e0e0e0; padding: 10px;">AppFactory Admin</td>
                                <td style="border: 1px solid #e0e0e0; padding: 10px;">비공개 키 업로드 → Push 연동 완료</td>
                            </tr>
                        </table>

                        <div class="note">
                            <strong>💡 팁:</strong> 이 리빌더 툴에서 다운로드한 프로젝트는 이미 AppFactory SDK가 적용되어 있습니다. 위 단계만 진행하면 바로 사용 가능합니다!
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="container">
        <h1>Android Project Rebuilder</h1>
        <p class="subtitle">자동 패키지명 변경, 앱 이름 수정, 버전 초기화 도구</p>

        <form id="rebuildForm">
            <!-- 필수 입력 -->
            <div class="form-group">
                <label>
                    Android 프로젝트 ZIP <span class="required">*</span>
                </label>
                <input type="file" id="projectZip" accept=".zip" required>
                <div class="file-info">압축된 Android 프로젝트 파일을 선택하세요</div>
            </div>

            <div class="form-group">
                <label>
                    새 패키지명 <span class="required">*</span>
                </label>
                <input type="text" id="newPackage" placeholder="com.example.newapp" required>
            </div>

            <div class="form-group">
                <label>
                    새 앱 이름 <span class="required">*</span>
                </label>
                <input type="text" id="newAppName" placeholder="MyNewApp" required>
            </div>

            <hr class="divider">

            <!-- 선택적 입력 -->
            <p class="section-title">선택 사항</p>

            <div class="form-group">
                <label>
                    google-services.json <span class="optional">(선택)</span>
                </label>
                <input type="file" id="googleServices" accept=".json">
                <div class="file-info">Firebase 설정 파일 (선택)</div>
            </div>

            <div class="form-group">
                <label>
                    앱 아이콘 이미지 <span class="optional">(선택)</span>
                </label>
                <input type="file" id="appIcon" accept=".png,.jpg,.jpeg">
                <div class="file-info">PNG 또는 JPG 형식 (모든 해상도에 적용)</div>
            </div>

            <div class="form-group">
                <label>
                    스플래시 이미지 <span class="optional">(선택)</span>
                </label>
                <input type="file" id="splashImage" accept=".png,.jpg,.jpeg">
                <div class="file-info">PNG 또는 JPG 형식 - 스플래시 화면에 사용되는 이미지</div>
            </div>

            <div class="form-group">
                <label>
                    새 BASE_URL <span class="optional">(선택)</span>
                </label>
                <input type="text" id="newBaseUrl" placeholder="https://api.example.com/ (마지막에 / 필수)">
                <div class="file-info">⚠️ 주의: 마지막에 반드시 슬래시(/)를 붙여주세요 (예: https://api.example.com/)</div>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="includeLog" checked>
                <label for="includeLog">
                    📋 ANDROID_REBUILDER_LOG.txt 파일 포함 (처리 로그 저장)
                </label>
            </div>

            <button type="submit" class="btn-primary" id="submitBtn">
                🚀 프로젝트 리빌드 시작
            </button>
        </form>

        <!-- 진행 상황 -->
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="log-container" id="logContainer"></div>
        </div>

        <!-- 성공/실패 메시지 -->
        <div class="success-message" id="successMessage">
            ✅ 리빌드 완료! 파일이 자동으로 다운로드됩니다.
        </div>
        <div class="error-message" id="errorMessage"></div>
    </div>

    <script>
        const form = document.getElementById('rebuildForm');
        const submitBtn = document.getElementById('submitBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const logContainer = document.getElementById('logContainer');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // 초기화
            progressContainer.style.display = 'block';
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';
            logContainer.innerHTML = '';
            submitBtn.disabled = true;
            submitBtn.textContent = '⏳ 처리 중...';

            // 진행바 애니메이션
            progressFill.style.width = '30%';
            addLog('프로젝트 업로드 중...', 'step');

            try {
                // FormData 생성
                const formData = new FormData();
                formData.append('project_zip', document.getElementById('projectZip').files[0]);
                formData.append('new_package', document.getElementById('newPackage').value);
                formData.append('new_app_name', document.getElementById('newAppName').value);

                // 선택적 파일
                const googleServices = document.getElementById('googleServices').files[0];
                if (googleServices) {
                    formData.append('google_services', googleServices);
                    addLog('Firebase 설정 포함', 'success');
                }

                const appIcon = document.getElementById('appIcon').files[0];
                if (appIcon) {
                    formData.append('app_icon', appIcon);
                    addLog('앱 아이콘 포함', 'success');
                }

                const splashImage = document.getElementById('splashImage').files[0];
                if (splashImage) {
                    formData.append('splash_image', splashImage);
                    addLog('스플래시 이미지 포함', 'success');
                }

                const newBaseUrl = document.getElementById('newBaseUrl').value;
                if (newBaseUrl) {
                    formData.append('new_base_url', newBaseUrl);
                    addLog(`BASE_URL: ${newBaseUrl}`, 'success');
                }

                // 로그 파일 포함 여부
                const includeLog = document.getElementById('includeLog').checked;
                formData.append('include_log', includeLog);
                if (includeLog) {
                    addLog('로그 파일 포함', 'success');
                }

                progressFill.style.width = '60%';
                addLog('서버 처리 중...', 'step');

                // API 호출
                const response = await fetch('/process', {
                    method: 'POST',
                    body: formData
                });

                progressFill.style.width = '90%';

                if (response.ok) {
                    // 성공 - Blob으로 다운로드
                    const blob = await response.blob();

                    // 서버에서 전달한 파일명 추출
                    const contentDisposition = response.headers.get('Content-Disposition');
                    let filename = 'rebuilt_project.zip'; // 기본값

                    if (contentDisposition) {
                        const filenameMatch = contentDisposition.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);
                        if (filenameMatch && filenameMatch[1]) {
                            filename = filenameMatch[1].replace(/['"]/g, '');
                            // URL 디코딩 (한글 파일명 지원)
                            filename = decodeURIComponent(filename);
                        }
                    }

                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);

                    progressFill.style.width = '100%';
                    addLog('리빌드 완료!', 'success');
                    addLog(`${filename} 다운로드 시작`, 'success');
                    successMessage.style.display = 'block';

                } else {
                    // 실패
                    const errorData = await response.json();
                    addLog('처리 중 오류 발생', 'error');

                    if (errorData.detail && errorData.detail.logs) {
                        errorData.detail.logs.forEach(log => {
                            addLog(log, getLogClass(log));
                        });
                    }

                    errorMessage.textContent = `❌ 오류: ${errorData.detail?.error || '알 수 없는 오류'}`;
                    errorMessage.style.display = 'block';
                }

            } catch (error) {
                addLog(`네트워크 오류: ${error.message}`, 'error');
                errorMessage.textContent = `❌ 오류: ${error.message}`;
                errorMessage.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '🚀 프로젝트 리빌드 시작';
            }
        });

        function addLog(message, className = '') {
            const logLine = document.createElement('div');
            logLine.className = `log-line ${className}`;
            logLine.textContent = message;
            logContainer.appendChild(logLine);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function getLogClass(log) {
            if (log.includes('ERROR')) return 'error';
            if (log.includes('WARNING')) return 'warning';
            if (log.includes('---')) return 'step';
            if (log.includes('Successfully') || log.includes('Completed')) return 'success';
            return '';
        }

        // Help Modal Functions
        function toggleHelp() {
            const modal = document.getElementById('helpModal');
            modal.classList.toggle('active');
        }

        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            const isActive = header.classList.contains('active');

            // Close all accordions
            document.querySelectorAll('.accordion-header').forEach(h => {
                h.classList.remove('active');
                h.nextElementSibling.classList.remove('active');
            });

            // Toggle current accordion
            if (!isActive) {
                header.classList.add('active');
                content.classList.add('active');
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('helpModal');
            if (e.target === modal) {
                modal.classList.remove('active');
            }
        });
    </script>
</body>
</html>
